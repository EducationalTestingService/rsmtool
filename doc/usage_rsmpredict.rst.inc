.. _usage_rsmpredict:

``rsmpredict`` - Generate new predictions
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

RSMTool provides the ``rsmpredict`` command-line utility to generate predictions for new data using a model already trained using the ``rsmtool`` utility. This can be useful when processing a new set of responses to the same task without needing to retrain the model.

``rsmpredict`` pre-processes the feature values according to user specifications before using them to generate the predicted scores. The generated scores are post-processed in the same manner as they are in ``rsmtool`` output.

.. note::
    No score is generated for responses with non-numeric values for any of the features included into the model.

    If the original model specified transformations for some of the features and these transformations led to ``NaN`` or ``Inf`` values when applied to the new data, ``rsmpredict`` will raise a warning. No score will be generated for such responses.


.. include:: tutorial_rsmpredict.rst.inc

Input
"""""
``rsmpredict`` requires two arguments to generate predictions: the path to :ref:`a configuration file <config_file_rsmpredict>` and the path to the output file where the generated predictions are saved in ``.csv`` format.

If you also want to save the pre-processed feature values,``rsmpredict`` can take a third optional argument ``--features`` to specify the path to a ``.csv`` file to save these values.

Here are all the arguments to the ``rsmpredict`` command-line script.

.. program:: rsmpredict

.. option:: config_file

    The :ref:`JSON configuration file <config_file_rsmpredict>` for this experiment.

.. option:: output_file

    The output ``.csv`` file where predictions will be saved.

.. option:: --features <preproc_feats_file>

    If specified, the pre-processed values for the input features will also be saved in this ``.csv`` file.

.. option:: -h, --help

    Show help message and exist.

.. option:: -V, --version

    Show version number and exit.

.. include:: config_rsmpredict.rst.inc

Output
""""""

``rsmpredict`` produces a ``.csv`` file with predictions for all responses in new data set, and, optionally, a ``.csv`` file with pre-processed feature values. If any of the responses had non-numeric feature values in
the original data or after applying transformations, these are saved in a file name ``PREDICTIONS_NAME_excluded_responses.csv`` where ``PREDICTIONS_NAME`` is the name of the predictions file supplied by the user without the extension.

The predictions ``.csv`` file contains the following columns:

- ``spkitemid`` : the unique resonse IDs from the original feature file.
- ``sc1`` and ``sc2`` : the human scores for each response from the original feature file (``human_score_column`` and ``second_human_score_column``, respectively.
- ``raw`` : raw predictions generated by the model.
- ``raw_trim``, ``raw_trim_round``, ``scale``, ``scale_trim``, ``scale_trim_round`` : raw scores :ref:`post-processed <score_postprocessing>` in different ways.

If logging to `Weights & Biases <https://wandb.ai/>`__ is :ref:`enabled <use_wandb_rsmpredict>`,
these csv files are also logged to the specified Weights & Biases project.
